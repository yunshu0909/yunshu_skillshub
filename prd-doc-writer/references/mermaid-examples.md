# Mermaid 图示例（需求侧）

> 用途：用图把"流程/状态/关键交互"讲清楚，减少歧义。
> 约束：尽量保持在需求层（用户可见行为与系统表现），不要写 API 路径、字段、HTTP code、框架/库。
> **复杂度控制**：单张图建议不超过 15-20 个节点。对于复杂流程，优先"分阶段绘制多张图"而不是一张巨大的图。

## 示例 1：用户操作流（Flowchart）

场景：手机端「一次性提醒」从列表到创建、触发、处理的闭环。

```mermaid
flowchart TD
  A[进入提醒列表] --> B{列表是否为空?}
  B -->|是| C[展示空态 + 引导“新建提醒”】【按钮：新建】]
  B -->|否| D[展示提醒列表（含状态：未到点/已到点待处理/已完成）]

  C --> E[点击“新建提醒”】【进入创建页/弹窗】]
  D --> E

  E --> F[填写：标题 + 时间]
  F --> G[点击“保存”】【返回列表】]
  G --> H[列表出现新提醒（未到点）]

  H --> I{到达提醒时间?}
  I -->|是| J[触发提醒：系统通知 + 应用内弹层（如在前台）]
  J --> K{用户选择}
  K -->|完成| L[标记已完成 + 从待处理移除]
  K -->|延期| M[选择延期时长（例如 10/30 分钟）并重新安排提醒]
  K -->|关闭| N[关闭弹层；提醒保留为“已到点待处理”】【在列表可见】]
```

## 示例 2：状态机（State Diagram）

场景：单个提醒的状态流转（“用户看得见/验收得了”的状态）。

```mermaid
stateDiagram-v2
  [*] --> 未到点

  未到点 --> 已到点待处理: 到达提醒时间
  已到点待处理 --> 已完成: 用户点击“完成”
  已到点待处理 --> 未到点: 用户点击“延期”并选择时长

  未到点 --> 已取消: 用户删除/取消提醒
  已到点待处理 --> 已取消: 用户删除/取消提醒

  已取消 --> [*]
  已完成 --> [*]
```

## 示例 3：关键场景时序（Sequence）

场景：创建提醒时的“权限提示/降级路径”（强调用户可见结果，不落到实现）。

```mermaid
sequenceDiagram
  participant U as 用户
  participant A as App/前台
  participant OS as 系统（通知权限/通知中心）

  U->>A: 点击“新建提醒”
  A-->>U: 展示创建表单（标题、时间）
  U->>A: 填写并点击“保存”

  A->>OS: 请求/检查通知权限（抽象）
  alt 权限已开启
    OS-->>A: 允许
    A-->>U: 保存成功提示；列表出现新提醒（未到点）
  else 权限未开启/被拒绝
    OS-->>A: 拒绝
    A-->>U: 提示“通知未开启，将仅在列表显示到点待处理”（降级说明）
    A-->>U: 仍保存提醒；列表出现新提醒（未到点）
  end
```

---

## 示例 4：B 端后台审批流（Flowchart）

场景：企业内部「报销审批」从提交到审批完成的完整流程（包含驳回重来）。

```mermaid
flowchart TD
  A[员工进入报销页面] --> B[填写报销信息：金额 + 类型 + 附件]
  B --> C[点击"提交审批"]
  C --> D[系统校验]

  D --> E{校验通过?}
  E -->|否| F[展示错误提示（如"附件缺失"）]
  F --> B

  E -->|是| G[提交成功；状态变为"待审批"]
  G --> H[通知审批人（系统通知/邮件）]

  H --> I{一级审批人操作}
  I -->|通过| J{金额是否 > 5000?}
  I -->|驳回| K[状态变为"已驳回"；通知员工并显示驳回理由]
  K --> L[员工修改后重新提交]
  L --> D

  J -->|否| M[状态变为"审批通过"；通知员工]
  J -->|是| N[流转到二级审批人；状态变为"二级审批中"]

  N --> O{二级审批人操作}
  O -->|通过| M
  O -->|驳回| K

  M --> P[财务打款；状态变为"已完成"]
  P --> Q[结束]
```

## 示例 5：B 端报销单状态机（State Diagram）

场景：单个报销单在系统中的状态流转（用户和审批人可见的状态）。

```mermaid
stateDiagram-v2
  [*] --> 草稿

  草稿 --> 待审批: 员工提交
  待审批 --> 一级审批中: 分配到审批人

  一级审批中 --> 二级审批中: 一级通过 & 金额>5000
  一级审批中 --> 审批通过: 一级通过 & 金额≤5000
  一级审批中 --> 已驳回: 一级驳回

  二级审批中 --> 审批通过: 二级通过
  二级审批中 --> 已驳回: 二级驳回

  已驳回 --> 草稿: 员工修改
  已驳回 --> 已取消: 员工撤销

  审批通过 --> 已完成: 财务打款

  已取消 --> [*]
  已完成 --> [*]
```

## 示例 6：B 端并发审批时序（Sequence）

场景：当审批需要"多人会签"（所有人都通过才算通过）时的并发处理逻辑。

```mermaid
sequenceDiagram
  participant E as 员工
  participant S as 系统
  participant A1 as 审批人A
  participant A2 as 审批人B
  participant A3 as 审批人C

  E->>S: 提交报销单（金额 8000 元）
  S-->>E: 提交成功；状态"待审批"

  S->>A1: 通知审批（并发）
  S->>A2: 通知审批（并发）
  S->>A3: 通知审批（并发）

  A1->>S: 通过（1/3）
  S-->>E: 更新进度"审批中 1/3"

  A3->>S: 通过（2/3）
  S-->>E: 更新进度"审批中 2/3"

  A2->>S: 驳回
  S-->>E: 状态变为"已驳回"；显示驳回理由
  S-->>A1: 通知"审批已终止"
  S-->>A3: 通知"审批已终止"

  Note over E,S: 任意一人驳回则整体驳回，<br/>员工修改后重新提交
```

